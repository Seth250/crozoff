(()=>{"use strict";function e(e){const t=e.currentTarget.value.toLowerCase();[...document.querySelectorAll(".todo-name")].forEach((e=>{const n=e.textContent.toLowerCase(),r=e.parentNode.parentNode;-1===n.indexOf(t)?r.classList.add("hide"):r.classList.remove("hide")}))}function t(e){window.matchMedia("(max-width: 600px)").matches&&(e.currentTarget.classList.toggle("fa-search"),e.currentTarget.classList.toggle("fa-arrow-left"),document.querySelector(".page-header h1").classList.toggle("collapse-mobile"),document.querySelector(".search-input").focus())}function n(e){return e.hasOwnProperty("defaultOffset")}const r=document.getElementById("todo-list-container"),a=document.getElementById("todo-form"),s=document.getElementById("total-pending"),o=document.querySelector(".message"),c=document.querySelector('input[name="csrfmiddlewaretoken"]').value;function d(e,t){o.classList.remove("hide"),o.classList.add(`message-${t}`,"fade"),o.textContent=e,setTimeout((()=>{o.classList.add("hide"),o.classList.remove(`message-${t}`,"fade")}),3550)}function i(e){return t=this,n=void 0,a=function*(){if(e.status){const{message:t,message_tag:n}=yield e.json();d(t,n)}else console.error(e),d("An Unexpected Error Occurred","error")},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{d(a.next(e))}catch(e){s(e)}}function c(e){try{d(a.throw(e))}catch(e){s(e)}}function d(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,c)}d((a=a.apply(t,n||[])).next())}));var t,n,r,a}function l(e,t=-200){const n=e.getBoundingClientRect().top;r.scrollTo({top:n+r.scrollTop+t,behavior:"smooth"}),window.scrollTo({top:n+window.pageYOffset+t/2,behavior:"smooth"})}function u(){return{Accept:"application/json","Content-type":"application/json; charset=UTF-8","X-Requested-With":"XMLHttpRequest","X-CSRFToken":c}}function m(e){e.preventDefault();const t=document.querySelector(".dragging"),r=function(e){const t=[...document.querySelectorAll('[draggable="true"]:not(.dragging)')].reduce(((t,r)=>{const a=r.getBoundingClientRect(),s=(e-a.top-a.height)/2;return n(t)&&s<-10&&s>t.defaultOffset?{offset:s,element:r}:t}),{defaultOffset:Number.NEGATIVE_INFINITY});return n(t)?null:t.element}(e.clientY);r?e.currentTarget.insertBefore(t,r):e.currentTarget.appendChild(t)}function g(e){e.currentTarget.classList.add("dragging")}function h(e){e.currentTarget.classList.remove("dragging"),e.currentTarget.style.transition="all 0.3s ease-in"}function f(e){const t=[...document.querySelectorAll(".todo-item")];if(e.target.classList.contains("fas"))e.target.classList.remove("fas","fa-arrows-alt"),e.target.classList.add("far","fa-save"),e.target.setAttribute("title","Save Your Changes"),t.forEach((e=>{e.setAttribute("draggable","true"),e.classList.add("draggable"),e.addEventListener("dragstart",g,!1),e.addEventListener("dragend",h,!1)})),r.addEventListener("dragover",m,!1);else{e.target.classList.remove("far","fa-save"),e.target.classList.add("fas","fa-arrows-alt"),e.target.setAttribute("title","Enable Todo re-arrangement");const n=[];t.forEach(((e,t)=>{const[r,a]=e.getAttribute("data-order").split("-");+a!==t&&n.push({pk:+r,order:t}),e.setAttribute("data-order",`${r}-${t}`),e.removeAttribute("draggable"),e.classList.remove("draggable"),e.removeEventListener("dragstart",g,!1),e.removeEventListener("dragend",h,!1)})),r.removeEventListener("dragover",m,!1),n.length&&fetch("save-order/",{method:"POST",headers:u(),body:JSON.stringify(n)}).then((e=>e.ok?e.json():Promise.reject(e))).then((({message:e,message_tag:t})=>d(e,t))).catch((e=>i(e)))}}function p(e){const t=document.createDocumentFragment(),n=document.createElement("div");n.classList.add("todo-item"),n.setAttribute("data-order",`${e.id}-${e.order}`),n.setAttribute("data-item",`item-${e.id}`);const r=document.createElement("div");r.classList.add("item-col-1");const a=document.createElement("div");a.classList.add("todo-name"),a.appendChild(document.createTextNode(e.item)),r.appendChild(a);const s=document.createElement("div");s.classList.add("todo-status");const o=document.createElement("form");o.setAttribute("method","POST");const d=document.createElement("input");d.setAttribute("name","csrfmiddlewaretoken"),d.setAttribute("type","hidden"),d.setAttribute("value",c),o.appendChild(d);const i=document.createElement("input");i.setAttribute("type","checkbox"),i.setAttribute("data-pk",e.id.toString()),i.setAttribute("title","Check this todo"),o.appendChild(i),s.appendChild(o);const l=document.createElement("span");l.classList.add(e.class_tag),l.appendChild(document.createTextNode(e.status)),s.appendChild(l),r.appendChild(s),n.appendChild(r);const u=document.createElement("div");u.classList.add("item-col-2");const m=document.createElement("a");m.setAttribute("href",`${e.id}/edit/`),m.classList.add("edit-link"),m.setAttribute("title","Edit this todo"),m.innerHTML='<i class="far fa-edit"></i>',u.appendChild(m);const g=document.createElement("button");return g.setAttribute("type","button"),g.classList.add("delete-button"),g.setAttribute("title","Delete this todo"),g.setAttribute("data-url",`${e.id}/delete/`),g.innerHTML='<i class="far fa-trash-alt"></i>',u.appendChild(g),n.appendChild(u),t.appendChild(n),t}function v({class_tag:e,status:t},n){const r=n.querySelector(".todo-status span");r.className=e,r.textContent=t}function y(e){let t=+s.textContent;s.textContent=("increment"===e?++t:--t).toString()}function L(e){e.preventDefault(),fetch(e.currentTarget.action,{method:e.currentTarget.method,headers:u(),body:JSON.stringify(Object.fromEntries(new FormData(e.currentTarget)))}).then((e=>e.ok?e.json():Promise.reject(e))).then((e=>{return"create"===e.action?(t=e,r.querySelector(".empty-todo-list")?r.replaceChild(p(t),r.firstElementChild):r.insertBefore(p(t),r.firstChild),y("increment"),d(t.message,t.message_tag),void l(r.firstElementChild)):function(e){const t=document.querySelector(`[data-item="item-${e.id}"]`);t.querySelector(".todo-name").textContent=e.item,v(e,t),d(e.message,e.message_tag),l(t)}(e);var t})).catch((e=>i(e))),e.currentTarget.reset(),e.currentTarget.removeAttribute("action")}function b(e){var t,n;e.target.matches('input[type="checkbox"]')?function(e){const t=e.getAttribute("data-pk"),n=document.querySelector(`[data-item="item-${t}"]`);fetch(`${t}/${e.checked?"check":"uncheck"}/`,{method:e.form.method,headers:u()}).then((e=>e.ok?e.json():Promise.reject(e))).then((e=>function(e,t){t.querySelector(".todo-name").classList.toggle("strike"),v(e,t),y("complete"===e.class_tag?"decrement":"increment"),d(e.message,e.message_tag)}(e,n))).catch((e=>i(e))),e.setAttribute("title",(e.checked?"Uncheck":"Check")+" this todo")}(e.target):e.target.matches(".edit-link")?(e.preventDefault(),t=e.target,fetch(t.href,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then((e=>e.ok?e.json():Promise.reject(e))).then((({item:e,due_date:n})=>{document.getElementById("id_item").value=e,document.getElementById("id_due_date").value=n.slice(0,-3),a.action=t.href,a.scrollIntoView(!0)})).catch((e=>i(e)))):e.target.matches(".delete-button")&&(n=e.target,fetch(n.getAttribute("data-url"),{method:"POST",headers:u()}).then((e=>e.ok?e.json():Promise.reject(e))).then((e=>{const t=n.parentNode.parentNode;t.style.transform="translateY(30%)",t.style.opacity="0",t.style.transition="all 0.35s ease-in",setTimeout((()=>{t.querySelector(".todo-status span").classList.contains("complete")||y("decrement"),r.removeChild(t),r.children.length||r.appendChild(function(){const e=document.createDocumentFragment(),t=document.createElement("div");return t.classList.add("empty-todo-list"),t.innerHTML="<p>No Todos to Display</p>",e.appendChild(t),e}())}),400),d(e.message,e.message_tag)})).catch((e=>i(e))))}function E(e){const t=e.currentTarget.querySelector(".fa-eye-slash"),n=e.currentTarget.querySelector(".fa-eye");t.classList.toggle("eye-slash-hide"),n.classList.toggle("eye-show");const r=e.currentTarget.previousElementSibling;r.type="password"===r.type?"text":"password"}window.addEventListener("load",(function(){const n=document.querySelector(".search-input");if(n){n.addEventListener("keyup",e,!1),document.querySelector(".search-icon").addEventListener("click",t,!1);const s=document.querySelector(".detail-bar"),o=document.querySelector(".detail-bar__nav");s.addEventListener("click",(()=>o.classList.toggle("hide")),!1),s.addEventListener("blur",(()=>o.classList.add("hide")),!1),document.querySelector(".move-icon").addEventListener("click",f,!1),r.addEventListener("click",b,!1),a.addEventListener("submit",L,!1)}else{const e=document.querySelector(".message-container");e&&document.querySelector(".close").addEventListener("click",(()=>e.classList.add("hide")),!1);const t=[...document.querySelectorAll(".password-toggler")];t.length&&t.forEach((e=>e.addEventListener("click",E,!1)))}}),!1)})();